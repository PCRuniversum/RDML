<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the RDML package • RDML</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the RDML package">
<meta property="og:description" content="RDML">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RDML</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/RDML.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CreateRDML.html">Creating RDML file from raw data</a>
    </li>
    <li>
      <a href="../articles/usingRDML_with_other_R_packages.html">Using RDML with other R packages</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/PCRuniversum/RDML/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="RDML_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PCRuniversum/RDML/blob/master/vignettes/RDML.Rmd"><code>vignettes/RDML.Rmd</code></a></small>
      <div class="hidden name"><code>RDML.Rmd</code></div>

    </div>

    
    
<div id="introduction-to-the-rdml-package" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-the-rdml-package" class="anchor"></a>Introduction to the RDML package</h2>
<p>The <a href="https://CRAN.R-project.org/package=RDML">RDML</a> package was created to work with the Real-time PCR Data Markup Language (RDML) – a structured and universal data standard for exchanging quantitative PCR (qPCR) data <span class="citation">(<span class="citeproc-not-found" data-reference-id="lefever_rdml_2009"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="rdml-ninja_2015"><strong>???</strong></span>)</span>. RDML belongs to the family of eXtensible Markup Languages (XML), and contains fluorescence data as well as information about the qPCR experiment. A description of the RDML schema and the RDML format are available at <a href="http://rdml.org" class="uri">http://rdml.org</a>.</p>
<p>The RDML package is published in Oxford Bioinformatics: Stefan Rödiger, Michał Burdukiewicz, Andrej-Nikolai Spiess, Konstantin Blagodatskikh; Enabling reproducible real-time quantitative PCR research: the RDML package, Bioinformatics, <a href="https://doi.org/10.1093/bioinformatics/btx528">https://doi.org/10.1093/bioinformatics/btx528</a> (see also <code><a href="https://rdrr.io/r/utils/citation.html">citation()</a></code>).</p>
<p>The XML technology is commonly used in the <strong>R</strong> environment and there are several tools to manipulate XML files <span class="citation">(<span class="citeproc-not-found" data-reference-id="xml_book"><strong>???</strong></span>)</span>. When working with XML data, the workhorse package is <strong>XML</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Lang_XML"><strong>???</strong></span>)</span>. Therefore, investments in development, implementation and maintenance is moderate.</p>
<p>We use the <strong>R6</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Chang_R6"><strong>???</strong></span>)</span>, <strong>assertthat</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Wickham_assertthat"><strong>???</strong></span>)</span>, <strong>plyr</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Wickham_plyr"><strong>???</strong></span>)</span>, <strong>dplyr</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Wickham_Francois_dplyr"><strong>???</strong></span>)</span>, <strong>tidyr</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Wickham_tidyr"><strong>???</strong></span>)</span> and <strong>rlist</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Ren_rlist"><strong>???</strong></span>)</span> packages.</p>
<div id="philosphy-of-the-rdml-package" class="section level3">
<h3 class="hasAnchor">
<a href="#philosphy-of-the-rdml-package" class="anchor"></a>Philosphy of the RDML package</h3>
<p><code>RDML</code> imports various data formats (CSV, XMLX) apart from the RDML format. Provided that the raw data have a defined structure (as described in the vignette), the import should be done by a few clicks. The example below shows the import of amplification curve data, which were stored in a CSV file. The function <code><a href="../reference/rdmlEdit.html">rdmlEdit()</a></code> was used in the <a href="https://rkward.kde.org/">RKWard IDE/GUI</a> <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger_rkward_2012"><strong>???</strong></span>)</span> (tested with version 0.6.9z+0.7.0+devel1 on Kubuntu 17.04; NOTE: problems were reported on systems where not the webkit component was used for the rendering of the <code><a href="../reference/rdmlEdit.html">rdmlEdit()</a></code> GUI) for further processing.</p>
<p><img src="File_import.png" alt="HTML5 Icon" style="width:663px;height:332px"></p>
<p>Once imported, this enables <code>rdmlEDIT()</code> and other functions from the <code>RDML</code> package to conduct complex data visualization and processing in the R statistical computing environment.</p>
<p><img src="data_view.png" alt="HTML5 Icon" style="width:663px;height:332px"></p>
</div>
<div id="major-functionalities-of-the-rdml-package" class="section level3">
<h3 class="hasAnchor">
<a href="#major-functionalities-of-the-rdml-package" class="anchor"></a>Major functionalities of the RDML package</h3>
<p>The public methods of the main R6 “RDML” class can be used to access and process the internally stored RDML data. These methods include:</p>
<ul>
<li>
<strong>new()</strong> – creates a new RDML object, empty or from a specified RDML file;</li>
<li>
<strong>AsDendrogram()</strong> – plots the structure of an RDML object as a dendrogram;</li>
<li>
<strong>AsTable()</strong> – represents the data contained in an RDML object (except fluorescence data) as a <em>data.frame</em>;</li>
<li>
<strong>GetFData()</strong> – gets fluorescence data;</li>
<li>
<strong>SetFData()</strong> – sets fluorescence data to an RDML object;</li>
<li>
<strong>AsXML()</strong> – saves an RDML object as an RDML<sub>v.</sub>1.2 file.</li>
</ul>
</div>
</div>
<div id="vendors-and-software-packages-supporting-rdml" class="section level2">
<h2 class="hasAnchor">
<a href="#vendors-and-software-packages-supporting-rdml" class="anchor"></a>Vendors and software packages supporting RDML</h2>
<p>The RDML format is supported by Bio-Rad (CFX 96 and CFX 384), Life Technologies (StepOne, ViiA7, QuantStudio) and Roche (LightCycler~96) thermocycler systems. In addition, several software packages (e.g., <strong>Primer3Plus</strong>, <strong>RDML-Ninja</strong>, <strong>qBase+</strong>) support RDML <span class="citation">(<span class="citeproc-not-found" data-reference-id="untergasser_2007"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="hellemans_2007"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="ruijter_amplification_2009"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="pabinger_2014"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="rdml-ninja_2015"><strong>???</strong></span>)</span>.</p>
</div>
<div id="structure-of-the-rdml-package" class="section level2">
<h2 class="hasAnchor">
<a href="#structure-of-the-rdml-package" class="anchor"></a>Structure of the <strong>RDML</strong> package</h2>
<p>The structure of the <strong>RDML</strong> package mimics the RDML format and provides several <a href="https://r6.r-lib.org/articles/Introduction.html">R6</a> classes that correspond to <a href="http://rdml.org/files.php?v=1.2">RDML v1.2</a> format types. All major manipulations with RDML data can be performed by a class called <strong>RDML</strong> through its public methods:</p>
<ul>
<li>
<code>$new()</code> – creates new <strong>RDML</strong> object (empty or from specified RDML file)</li>
<li>
<code>$AsTable()</code> – represents data contained in <strong>RDML</strong> object (except fluorescent data) as data.frame.</li>
<li>
<code>$GetFData()</code> – gets fluorescent data.</li>
<li>
<code>$SetFData()</code> – sets fluorescent data to <strong>RDML</strong> object.</li>
<li>
<code>$AsDendrogram()</code> – represents structure of <strong>RDML</strong> object as dendrogram.</li>
</ul>
<div id="opening-and-observing-rdml-file" class="section level3">
<h3 class="hasAnchor">
<a href="#opening-and-observing-rdml-file" class="anchor"></a>Opening and observing RDML file</h3>
<p>In this section, we will use the built-in RDML example file <code>lc96_bACTXY.rdml</code>. This file was obtained during the measurement of human DNA concentration by a <em>LightCycler 96</em> (Roche) and the <em>XY-Detect</em> kit (Syntol, Russia).</p>
<p>To open the <code>lc96_bACTXY.rdml</code> file, we have to create a new <strong>RDML</strong> object with its class initializer – <code>$new()</code> and the file name as parameter <code>filename</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/lc96_bACTXY.rdml"</span>, package = <span class="st">"RDML"</span>)
<span class="kw">lc96</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(filename = <span class="kw">filename</span>)
</pre></div>
<p>Next we can check the structure of our new object – <code>lc96</code> by printing it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">lc96</span>
<span class="co">#&gt; dateMade: 2014-08-19T11:25:48</span>
<span class="co">#&gt; dateUpdated: 2014-08-27T12:06:21</span>
<span class="co">#&gt; id: [Roche Diagnostics]</span>
<span class="co">#&gt; experimenter: []</span>
<span class="co">#&gt; documentation: []</span>
<span class="co">#&gt; dye: [FAM, Hex, Texas Red, Cy5]</span>
<span class="co">#&gt; sample: [Sample 39, Sample 41, Sample 43, Sample 45, Sample 51, Sample 53, Sample 54, Sample 55, Sample 56, Sample 57, Sample 58]</span>
<span class="co">#&gt; target: [30116ec1-44f6-4c9c-9c69-5d6f00226d4e, 69b0b5cd-591c-4012-a995-7a8b53861548, 7797a698-1b2d-4819-bf7d-1188f2c8ca7f, c16f36ee-8636-40d2-ae72-b00d3b2eb89d, bACT, X, Y, IPC]</span>
<span class="co">#&gt; thermalCyclingConditions: [2f78ed33-724e-4a29-97e9-92296eb868e1]</span>
<span class="co">#&gt; experiment: [ca1eb225-ecea-4793-9804-87bfbb45f81d]</span>
</pre></div>
<p>As a result we can see field names, and after <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code></p>
<ul>
<li>names of the <code>R6</code> objects contained at this field after <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>,</li>
<li>contained values after <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code>,</li>
<li>names of list elements enclosed in <code>[]</code>.</li>
</ul>
<p>The field names for all <strong>RDML</strong> package classes correspond to field names of RDML types as described at <a href="http://rdml.org/files.php?v=1.2" class="uri">http://rdml.org/files.php?v=1.2</a>.</p>
<p><img src="rdml_overview_1_2.png" alt="HTML5 Icon" style="width:663px;height:688px"></p>
<p>Image source: <a href="http://rdml.org/" class="uri">http://rdml.org/</a>.</p>
<p>For the base class <strong>RDML</strong>, these are:</p>
<ul>
<li><code>dateMade</code></li>
<li><code>dateUpdated</code></li>
<li>
<code>id</code> – publisher and id to the RDML file.</li>
<li>
<code>experimenter</code> – contact details of the experimenter.</li>
<li>
<code>documentation</code> – these elements should be used if the same description applies to many samples, targets, or experiments.</li>
<li>
<code>dye</code> – information about a dye.</li>
<li>
<code>sample</code> – defined template solutions.</li>
<li>
<code>target</code> – defined PCR reactions.</li>
<li>
<code>thermalCyclingConditions</code> – cycling programs for PCR or to amplify cDNA.</li>
<li><code>experiment</code></li>
</ul>
<p>These fields can be divided by two parts:</p>
<div id="experiment-field" class="section level4">
<h4 class="hasAnchor">
<a href="#experiment-field" class="anchor"></a>Experiment field</h4>
<p>Contains one or more experiments with fluorescence data. Fluorescence data are stored at the <em>data</em> level of an experiment. For example, fluorescence data for reaction tube <em>45</em> and target <em>bACT</em> can be accessed with the following code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">fdata</span> <span class="op">&lt;-</span> 
  <span class="kw">lc96</span><span class="op">$</span>
    <span class="kw">experiment</span><span class="op">$</span><span class="kw">`ca1eb225-ecea-4793-9804-87bfbb45f81d`</span><span class="op">$</span>
    <span class="kw">run</span><span class="op">$</span><span class="kw">`65aeb1ec-b377-4ef6-b03f-92898d47488b`</span><span class="op">$</span>
    <span class="kw">react</span><span class="op">$</span><span class="kw">`45`</span><span class="op">$</span>
    <span class="kw">data</span><span class="op">$</span><span class="kw">bACT</span><span class="op">$</span>
    <span class="kw">adp</span><span class="op">$</span><span class="kw">fpoints</span> <span class="co">#'adp' means amplification data points (qPCR)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">fdata</span>)
<span class="co">#&gt;    cyc     tmp     fluor</span>
<span class="co">#&gt; 1:   1 68.0054 0.0782385</span>
<span class="co">#&gt; 2:   2 68.0429 0.0753689</span>
<span class="co">#&gt; 3:   3 68.0451 0.0736838</span>
<span class="co">#&gt; 4:   4 68.0525 0.0723196</span>
<span class="co">#&gt; 5:   5 68.0537 0.0717019</span>
<span class="co">#&gt; 6:   6 68.0538 0.0714182</span>
</pre></div>
<p>The structure of experiments can be visualized by plotting dendrograms. <a name="dendrogram"></a></p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/dendrogram-1.png" width="576"></p>
<p>In this dendrogram <a href="#dendrogram">1</a> we can see that our file consists of one experiment and one run. Four targets, each with two sample types (<em>std</em> – standard, <em>unkn</em> – unknown), are part of the experiment. There is only qPCR data – <em>adp</em> in this experiment. Ten reactions (tubes) for standard type (<em>std</em>) and six reaction for the unknown (<em>unkn</em>) type. The total number of reactions can be more than the number of reactions on the plate because one tube can contain more than one target (e.g., multiplexing).</p>
</div>
<div id="additional-information-fields" class="section level4">
<h4 class="hasAnchor">
<a href="#additional-information-fields" class="anchor"></a>Additional information fields</h4>
<p>All fields other than <strong>experiment</strong>. This additional information can be referenced in other parts of the RDML file. For example, to access sample added to react <em>39</em> and get its quantity, we can use code like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">ref</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span>
          <span class="kw">experiment</span><span class="op">$</span><span class="kw">`ca1eb225-ecea-4793-9804-87bfbb45f81d`</span><span class="op">$</span>
          <span class="kw">run</span><span class="op">$</span><span class="kw">`65aeb1ec-b377-4ef6-b03f-92898d47488b`</span><span class="op">$</span>
          <span class="kw">react</span><span class="op">$</span><span class="kw">`39`</span><span class="op">$</span>
          <span class="kw">sample</span><span class="op">$</span><span class="kw">id</span>
<span class="kw">sample</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span><span class="kw">sample</span>[[<span class="kw">ref</span>]]
<span class="kw">sample</span><span class="op">$</span><span class="kw">quantity</span><span class="op">$</span><span class="kw">value</span>
<span class="co">#&gt; [1] 25</span>
</pre></div>
</div>
</div>
<div id="copying-rdml-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#copying-rdml-objects" class="anchor"></a>Copying <strong>RDML</strong> objects</h3>
<p><strong>R6</strong> objects are environments, that’s why simple copying results in creating references to existing objects. Then modifying the copy leads to modification of the original object. To create a <em>real</em> copy of the object, we have to use method <code>$clone(deep = TRUE)</code> provided by the <strong>R6</strong> class (or its shortcut <code>$copy()</code> inside <strong>RDML</strong> package).</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">id1</span> <span class="op">&lt;-</span> <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"id_1"</span>)
<span class="kw">id2</span> <span class="op">&lt;-</span> <span class="kw">id1</span>
<span class="kw">id3</span> <span class="op">&lt;-</span> <span class="kw">id1</span><span class="op">$</span><span class="fu">copy</span>()
<span class="kw">id2</span><span class="op">$</span><span class="kw">id</span> <span class="op">&lt;-</span> <span class="st">"id_2"</span>
<span class="kw">id3</span><span class="op">$</span><span class="kw">id</span> <span class="op">&lt;-</span> <span class="st">"id_3"</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Original object\t\t: %s ('id_1' became 'id_2')\nSimple copy\t\t\t: %s\n'Real' copy (clone)\t: %s\n"</span>,
            <span class="kw">id1</span><span class="op">$</span><span class="kw">id</span>, <span class="kw">id2</span><span class="op">$</span><span class="kw">id</span>, <span class="kw">id3</span><span class="op">$</span><span class="kw">id</span>))
<span class="co">#&gt; Original object      : id_2 ('id_1' became 'id_2')</span>
<span class="co">#&gt; Simple copy          : id_2</span>
<span class="co">#&gt; 'Real' copy (clone)  : id_3</span>
</pre></div>
<p>From the example above, we can see that the modification of <code>id2</code> led to a modification of the original object <code>id1</code>, however modification of cloned object <code>id3</code> did not.</p>
</div>
<div id="modifying-rdml-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#modifying-rdml-objects" class="anchor"></a>Modifying <strong>RDML</strong> objects</h3>
<p>To modify the content of <strong>RDML</strong> objects, we can use fields as setters. These setters provide type safe modifications by input validation. In addition, setting lists of objects generates names of list elements.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co">## Create 'real' copy of object</span>
<span class="kw">experiment</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span><span class="kw">experiment</span><span class="op">$</span><span class="kw">`ca1eb225-ecea-4793-9804-87bfbb45f81d`</span><span class="op">$</span><span class="fu">copy</span>()
<span class="co">## Try to set 'id' with wrong input type.</span>
<span class="co">## Correct type 'idType' can be seen at error message.</span>
<span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(<span class="kw">experiment</span><span class="op">$</span><span class="kw">id</span> <span class="op">&lt;-</span> <span class="st">"exp1"</span>,
         error = <span class="fu">function</span>(<span class="kw">e</span>) <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">e</span>))
<span class="co">#&gt; &lt;simpleError in (function (id) {    if (missing(id))         return(private$.id)    assertR6(id, "idType")    private$.id &lt;- id})(base::quote("exp1")): Assertion on 'id' failed: Must be an R6 class, not character.&gt;</span>

<span class="co">## Set 'id' with correct input type - 'idType'</span>
<span class="kw">experiment</span><span class="op">$</span><span class="kw">id</span> <span class="op">&lt;-</span> <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"exp1"</span>)

<span class="co">## Similar operations for 'run'</span>
<span class="kw">run</span> <span class="op">&lt;-</span> <span class="kw">experiment</span><span class="op">$</span><span class="kw">run</span><span class="op">$</span><span class="kw">`65aeb1ec-b377-4ef6-b03f-92898d47488b`</span><span class="op">$</span><span class="fu">copy</span>()
<span class="kw">run</span><span class="op">$</span><span class="kw">id</span> <span class="op">&lt;-</span> <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"run1"</span>)

<span class="co">## Replace original elements with modified</span>
<span class="kw">experiment</span><span class="op">$</span><span class="kw">run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">run</span>)
<span class="kw">lc96</span><span class="op">$</span><span class="kw">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">experiment</span>)
</pre></div>
<p><a name="dendrogram_modified"></a></p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/dendrogram_modified-1.png" width="576"></p>
<p>Then, we can observe in <a href="#dendrogram_modified">2</a> our modification with the <code>$AsDendrogram()</code> method.</p>
</div>
<div id="astable-method" class="section level3">
<h3 class="hasAnchor">
<a href="#astable-method" class="anchor"></a><code>AsTable()</code> method</h3>
<p>To obtain information about all fluorescence data in an RDML file (type of added sample, used target, starting quantity etc.) as a data.frame, we can use the <code>$AsTable()</code> method. By default, it provides such information as:</p>
<ul>
<li>
<code>fdata.name</code> – aggregated name for current fluorescence data. Default pattern is <code>position_sample_sample.type_target</code> (e.g., <em>D03_Sample 39_std_bACT</em>). This pattern can be modified by <code>name.pattern</code> argument.</li>
<li>
<code>exp.id</code> – experiment id (e.g., <em>exp1</em>).</li>
<li>
<code>run.id</code> – run id (e.g., <em>run1</em>).</li>
<li>
<code>react.id</code> – react (tube) id (e.g., <em>39</em>).</li>
<li>
<code>position</code> – react (tube) position (e.g., <em>D03</em>).</li>
<li>
<code>sample</code> – name of the added sample (e.g., <em>Sample 39</em>).</li>
<li>
<code>target</code> – detection target (e.g., <em>bACT</em>).</li>
<li>
<code>target.dyeId</code> – detection dye (e.g., <em>FAM</em>).</li>
<li>
<code>sample,type</code> – type of the added sample (e.g., <em>std</em>).</li>
<li>
<code>adp</code> – <code>TRUE</code> if contains qPCR data.</li>
<li>
<code>mdp</code> – <code>TRUE</code> if contains melting data.</li>
</ul>
<p>To add custom columns to the output <em>data.frame</em>, we should pass it as a named method argument by generating expressions. Values for default columns can be used by custom name patterns and new columns referring to their names. The next example shows how to use the <code>$AsTable()</code> method with a custom name pattern and additional columns.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">tab</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/AsTable.html">AsTable</a></span>(
  <span class="co"># Custom name pattern 'position~sample~sample.type~target~dye'</span>
  name.pattern = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(
             <span class="kw">react</span><span class="op">$</span><span class="kw">position</span>,
             <span class="kw">react</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">id</span>,
             <span class="kw">private</span><span class="op">$</span><span class="kw">.sample</span>[[<span class="kw">react</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">id</span>]]<span class="op">$</span><span class="kw">type</span><span class="op">$</span><span class="kw">value</span>,
             <span class="kw">data</span><span class="op">$</span><span class="kw">tar</span><span class="op">$</span><span class="kw">id</span>,
             <span class="kw">target</span>[[<span class="kw">data</span><span class="op">$</span><span class="kw">tar</span><span class="op">$</span><span class="kw">id</span>]]<span class="op">$</span><span class="kw">dyeId</span><span class="op">$</span><span class="kw">id</span>,
             sep = <span class="st">"~"</span>),
  <span class="co"># Custom column 'quantity' - starting quantity of added sample </span>
  quantity = {
    <span class="kw">value</span>  <span class="op">&lt;-</span> <span class="kw">sample</span>[[<span class="kw">react</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">id</span>]]<span class="op">$</span><span class="kw">quantity</span><span class="op">$</span><span class="kw">value</span>
    <span class="co">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="kw">value</span>) <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">value</span>)) <span class="kw">NULL</span>
    <span class="co">else</span> <span class="kw">value</span>
  }
)
<span class="co">## Remove row names for compact printing</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="kw">tab</span>) <span class="op">&lt;-</span> <span class="kw">NULL</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">tab</span>)
<span class="co">#&gt;                       fdata.name exp.id run.id react.id position    sample</span>
<span class="co">#&gt; 1:     D03~Sample 39~std~IPC~Cy5   exp1   run1       39      D03 Sample 39</span>
<span class="co">#&gt; 2:       D03~Sample 39~std~X~Hex   exp1   run1       39      D03 Sample 39</span>
<span class="co">#&gt; 3: D03~Sample 39~std~Y~Texas Red   exp1   run1       39      D03 Sample 39</span>
<span class="co">#&gt; 4:    D03~Sample 39~std~bACT~FAM   exp1   run1       39      D03 Sample 39</span>
<span class="co">#&gt; 5:     D04~Sample 39~std~IPC~Cy5   exp1   run1       40      D04 Sample 39</span>
<span class="co">#&gt; 6:       D04~Sample 39~std~X~Hex   exp1   run1       40      D04 Sample 39</span>
<span class="co">#&gt;    target target.dyeId sample.type  adp   mdp quantity</span>
<span class="co">#&gt; 1:    IPC          Cy5         std TRUE FALSE       25</span>
<span class="co">#&gt; 2:      X          Hex         std TRUE FALSE       25</span>
<span class="co">#&gt; 3:      Y    Texas Red         std TRUE FALSE       25</span>
<span class="co">#&gt; 4:   bACT          FAM         std TRUE FALSE       25</span>
<span class="co">#&gt; 5:    IPC          Cy5         std TRUE FALSE       25</span>
<span class="co">#&gt; 6:      X          Hex         std TRUE FALSE       25</span>
</pre></div>
<p>Here, the generated data.frame is also used as a query in <code>$GetFData()</code> and <code>$SetFData()</code> methods (see further sections).</p>
</div>
<div id="getting-fluorescence-data" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-fluorescence-data" class="anchor"></a>Getting fluorescence data</h3>
<p>We can extract the fluorescence data in two ways:</p>
<ul>
<li>direct access to the data as described in the <em>Experiment field</em> subsection</li>
<li>using the special method <code>$GetFData()</code>
</li>
</ul>
<p>The advantage of <code>$GetFData()</code> is that it can combine fluorescence data from many plates into one data.frame. The major argument of this function is <code>request</code>, which defines fluorescence data to be extracted. This request is the output from the <code>$AsTable()</code> method and can be easily filtered by the <strong>dplyr</strong> <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function. Furthermore, cycle limits, the output <code>data.frame</code> format, as well as data types (<code>fdata.type = 'adp'</code> for qPCR, <code>fdata.type = 'mdp'</code> for melting data) can by specified (see examples below).</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)

<span class="co">## Prepare request to get only 'std' type samples</span>
<span class="kw">filtered.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">tab</span>,
                       <span class="kw">sample.type</span> <span class="op">==</span> <span class="st">"std"</span>)

<span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(<span class="kw">filtered.tab</span>,
                       <span class="co"># long table format for usage with ggplot2</span>
                       long.table = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">fdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">cyc</span>, <span class="kw">fluor</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(group = <span class="kw">fdata.name</span>,
                  color = <span class="kw">target</span>))
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>Our example curves are not background subtracted, as visible in the plot. To accomplish this, we use the <code><a href="https://rdrr.io/pkg/chipPCR/man/CPP.html">CPP()</a></code> function from the <a href="https://CRAN.R-project.org/package=chipPCR">chipPCR</a> package <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger2015chippcr"><strong>???</strong></span>)</span> as described in <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger2015r"><strong>???</strong></span>)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/michbur/chipPCR">chipPCR</a></span>)
<span class="kw">tab</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/AsTable.html">AsTable</a></span>(
  <span class="co"># Custom name pattern 'position~sample~sample.type~target~run.id'</span>
  name.pattern = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(
             <span class="kw">react</span><span class="op">$</span><span class="kw">position</span>,
             <span class="kw">react</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">id</span>,
             <span class="kw">private</span><span class="op">$</span><span class="kw">.sample</span>[[<span class="kw">react</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">id</span>]]<span class="op">$</span><span class="kw">type</span><span class="op">$</span><span class="kw">value</span>,
             <span class="kw">data</span><span class="op">$</span><span class="kw">tar</span><span class="op">$</span><span class="kw">id</span>,
             <span class="kw">run</span><span class="op">$</span><span class="kw">id</span><span class="op">$</span><span class="kw">id</span>, <span class="co"># run id added to names</span>
             sep = <span class="st">"~"</span>))
<span class="co">## Get all fluorescence data</span>
<span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(<span class="kw">tab</span>,
                                     <span class="co"># We don't need long table format for CPP()</span>
                                     long.table = <span class="fl">FALSE</span>))

<span class="kw">fdata.cpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(cyc = <span class="kw">fdata</span>[, <span class="fl">1</span>],
                   <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">fdata</span>[, <span class="op">-</span><span class="fl">1</span>], <span class="fl">2</span>,
                         <span class="fu">function</span>(<span class="kw">x</span>) <span class="fu"><a href="https://rdrr.io/pkg/chipPCR/man/CPP.html">CPP</a></span>(<span class="kw">fdata</span>[, <span class="fl">1</span>],
                                         <span class="kw">x</span>)<span class="op">$</span><span class="kw">y</span>))
</pre></div>
<p>Now we have properly preprocessed data, which we will add to our object and use in the next section.</p>
</div>
<div id="setting-fluorescence-data" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-fluorescence-data" class="anchor"></a>Setting fluorescence data</h3>
<p>To define fluorescence data as an <strong>RDML</strong> object, we can use the <code>$SetFData()</code> method. It takes three arguments:</p>
<ul>
<li>
<code>fdata</code> – fluorescence data in <code>long.table = FALSE</code> format</li>
<li>
<code>request</code> – output from the <code><a href="../reference/AsTable.html">AsTable()</a></code> function, which is used to set data;</li>
<li>
<code>fdata.type</code> – <code>fdata.type = 'adp'</code> for qPCR, <code>fdata.type = 'mdp'</code> for melting data.</li>
</ul>
<p>In the following we will define preprocessed fluorescence data as the new run – <em>run1_cpp</em>. The subelements of RDML such as <em>experiment</em>, <em>run</em>, <em>react</em> and <em>data</em> that do not initially exist in an <strong>RDML</strong> object are created by SetFData automatically (read more at <em>Creating <strong>RDML</strong> from table</em> section).</p>
<blockquote>
<p>Note that the colnames in <code>fdata</code> and <code>fdata.name</code> in <code>request</code> have to be the same!</p>
</blockquote>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">tab</span><span class="op">$</span><span class="kw">run.id</span> <span class="op">&lt;-</span> <span class="st">"run.cpp"</span>
<span class="co">## Set fluorescence data from previous section</span>
<span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/SetFData.html">SetFData</a></span>(<span class="kw">fdata.cpp</span>,
              <span class="kw">tab</span>)

<span class="co">## View setted data</span>
<span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="kw">lc96</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(<span class="kw">tab</span>,
                       long.table = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">fdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">cyc</span>, <span class="kw">fluor</span>)) <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(group = <span class="kw">fdata.name</span>,
                  color = <span class="kw">target</span>))
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
</div>
<div id="merging-rdml-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#merging-rdml-objects" class="anchor"></a>Merging <strong>RDML</strong> objects</h3>
<p>Merging <strong>RDML</strong> objects can be conducted by the <code><a href="../reference/MergeRDMLs.html">MergeRDMLs()</a></code> function. It takes a list of <strong>RDML</strong> objects and returns one single <strong>RDML</strong> object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co">## Load another built in RDML file</span>
<span class="kw">stepone</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/find.package.html">path.package</a></span>(<span class="st">"RDML"</span>),
                           <span class="st">"/extdata/"</span>, <span class="st">"stepone_std.rdml"</span>))
<span class="co">## Merge it with our 'lc96' object</span>
<span class="kw">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MergeRDMLs.html">MergeRDMLs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lc96</span>, <span class="kw">stepone</span>))
<span class="co">## View structure of new object</span>
<span class="kw">merged</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
<span class="co">#&gt; Warning in self$AsTable(): fdata.name column has duplicates! Try another</span>
<span class="co">#&gt; 'name.pattern'.</span>
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
<div id="saving-rdml-object-as-rdml-file" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-rdml-object-as-rdml-file" class="anchor"></a>Saving <strong>RDML</strong> object as RDML file</h3>
<p>To save <strong>RDML</strong> objects in RDML file v1.2 format, we can use the <code>$AsXML()</code> method where the <code>file.name</code> argument is the name of new RDML file. Without <code>file.name</code> given, the function returns an XML tree.</p>
<p><code>lc96$AsXML("lc96.rdml")</code></p>
<p>One can use <a href="https://sourceforge.net/projects/qpcr-ninja/">RDML-ninja</a> or the <a href="http://rdml.org/tools.php?validator">RDML validator</a> from the RMDL consortium to validate RDML files created by the <strong>RDML</strong> package.</p>
</div>
<div id="creating-custom-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-custom-functions" class="anchor"></a>Creating custom functions</h3>
<p><strong>R6</strong> classes allow to add methods to existing classes by using the <code>$set()</code> method. Suppose that we want to add a method to preprocess all fluorescence data and calculate Cq values:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">RDML</span><span class="op">$</span><span class="fu">set</span>(<span class="st">"public"</span>, <span class="st">"CalcCq"</span>,
         <span class="fu">function</span>() {
           <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/michbur/chipPCR">chipPCR</a></span>)
           <span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">self</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(
             <span class="kw">self</span><span class="op">$</span><span class="fu"><a href="../reference/AsTable.html">AsTable</a></span>()))
           <span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(cyc = <span class="kw">fdata</span>[, <span class="fl">1</span>],
                          <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">fdata</span>[, <span class="op">-</span><span class="fl">1</span>],
                                <span class="fl">2</span>,
                                <span class="fu">function</span>(<span class="kw">x</span>)
                                  <span class="co"># Data preprocessing</span>
                                  <span class="fu"><a href="https://rdrr.io/pkg/chipPCR/man/CPP.html">CPP</a></span>(<span class="kw">fdata</span>[, <span class="fl">1</span>],
                                      <span class="kw">x</span>)<span class="op">$</span><span class="kw">y</span>)
                          )
           
           <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">fdata</span>[, <span class="op">-</span><span class="fl">1</span>], <span class="fl">2</span>,
                 <span class="fu">function</span>(<span class="kw">x</span>) {
                   <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(
                     <span class="co"># Calculate Cq</span>
                     <span class="fu"><a href="https://rdrr.io/pkg/chipPCR/man/th.cyc.html">th.cyc</a></span>(<span class="kw">fdata</span>[, <span class="fl">1</span>], <span class="kw">x</span>,
                            auto = <span class="fl">TRUE</span>)<span class="op">@</span>.Data[<span class="fl">1</span>],
                     error = <span class="fu">function</span>(<span class="kw">e</span>) <span class="fl">NA</span>)
                 })
         }
)

<span class="co">## Create new object with our advanced class</span>
<span class="kw">stepone</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/find.package.html">path.package</a></span>(<span class="st">"RDML"</span>),
                           <span class="st">"/extdata/"</span>, <span class="st">"stepone_std.rdml"</span>))
</pre></div>
<p>We can then apply our new method:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">stepone</span><span class="op">$</span><span class="fu">CalcCq</span>()
<span class="co">#&gt;         A01_NTC_RNase P_ntc_RNase P         A02_NTC_RNase P_ntc_RNase P </span>
<span class="co">#&gt;                           13.801661                           12.964268 </span>
<span class="co">#&gt;         A03_NTC_RNase P_ntc_RNase P       A04_pop1_RNase P_unkn_RNase P </span>
<span class="co">#&gt;                           14.399910                           13.529380 </span>
<span class="co">#&gt;       A05_pop1_RNase P_unkn_RNase P       A06_pop1_RNase P_unkn_RNase P </span>
<span class="co">#&gt;                           14.609048                           14.160886 </span>
<span class="co">#&gt;       A07_pop2_RNase P_unkn_RNase P       A08_pop2_RNase P_unkn_RNase P </span>
<span class="co">#&gt;                           11.839277                           10.947218 </span>
<span class="co">#&gt;       B01_pop2_RNase P_unkn_RNase P B02_STD_RNase P_10000.0_std_RNase P </span>
<span class="co">#&gt;                           13.167509                           13.415532 </span>
<span class="co">#&gt; B03_STD_RNase P_10000.0_std_RNase P B04_STD_RNase P_10000.0_std_RNase P </span>
<span class="co">#&gt;                           13.363262                           14.082731 </span>
<span class="co">#&gt;  B05_STD_RNase P_5000.0_std_RNase P  B06_STD_RNase P_5000.0_std_RNase P </span>
<span class="co">#&gt;                           13.039183                           14.012804 </span>
<span class="co">#&gt;  B07_STD_RNase P_5000.0_std_RNase P  B08_STD_RNase P_2500.0_std_RNase P </span>
<span class="co">#&gt;                            9.790724                           12.981337 </span>
<span class="co">#&gt;  C01_STD_RNase P_2500.0_std_RNase P  C02_STD_RNase P_2500.0_std_RNase P </span>
<span class="co">#&gt;                           15.666928                           13.132126 </span>
<span class="co">#&gt;  C03_STD_RNase P_1250.0_std_RNase P  C04_STD_RNase P_1250.0_std_RNase P </span>
<span class="co">#&gt;                           13.905808                           14.974769 </span>
<span class="co">#&gt;  C05_STD_RNase P_1250.0_std_RNase P   C06_STD_RNase P_625.0_std_RNase P </span>
<span class="co">#&gt;                           13.880906                           12.850727 </span>
<span class="co">#&gt;   C07_STD_RNase P_625.0_std_RNase P   C08_STD_RNase P_625.0_std_RNase P </span>
<span class="co">#&gt;                           16.915642                           13.706484</span>
</pre></div>
</div>
<div id="creating-rdml-from-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-rdml-from-tables" class="anchor"></a>Creating <strong>RDML</strong> from tables</h3>
<p><strong>RDML</strong> objects can not only be generated from files but also from user data contained in data.frames. For this, we have to create an empty <strong>RDML</strong> object, create a data.frame containing the data and set it by the <code>$SetFData()</code> method. Minimal required information (samples, targets, dyes) will be created from the data description.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co">#### Create simulated data with AmpSim() from chipPCR package</span>
<span class="co">## Cq for data to be generated</span>
<span class="kw">Cqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>, <span class="fl">17</span>, <span class="fl">19</span>, <span class="fl">21</span>)
<span class="co">## PCR si,ulation will be 35 cycles</span>
<span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(cyc = <span class="fl">1</span><span class="op">:</span><span class="fl">35</span>)
<span class="co">for</span>(<span class="kw">Cq</span> <span class="co">in</span> <span class="kw">Cqs</span>) {
  <span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">fdata</span>,
                 <span class="fu"><a href="https://rdrr.io/pkg/chipPCR/man/AmpSim.html">AmpSim</a></span>(cyc = <span class="fl">1</span><span class="op">:</span><span class="fl">35</span>, Cq = <span class="kw">Cq</span>)[, <span class="fl">2</span>])
}
<span class="co">## Set names for fluorescence curves</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">fdata</span>)[<span class="fl">2</span><span class="op">:</span><span class="fl">5</span>] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"c1"</span>, <span class="st">"c2"</span>, <span class="st">"c3"</span>, <span class="st">"c4"</span>)

<span class="co">## Create minimal description</span>
<span class="kw">descr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  fdata.name = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"c1"</span>, <span class="st">"c2"</span>, <span class="st">"c3"</span>, <span class="st">"c4"</span>),
  exp.id = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"exp1"</span>, <span class="st">"exp1"</span>, <span class="st">"exp1"</span>, <span class="st">"exp1"</span>),
  run.id = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"run1"</span>, <span class="st">"run1"</span>, <span class="st">"run1"</span>, <span class="st">"run1"</span>),
  react.id = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  sample = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s1"</span>, <span class="st">"s1"</span>, <span class="st">"s2"</span>, <span class="st">"s2"</span>),
  sample.type = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"unkn"</span>, <span class="st">"unkn"</span>, <span class="st">"unkn"</span>, <span class="st">"unkn"</span>),
  target = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gene1"</span>, <span class="st">"gene2"</span>, <span class="st">"gene1"</span>, <span class="st">"gene2"</span>),
  target.dyeId = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"FAM"</span>, <span class="st">"ROX"</span>, <span class="st">"FAM"</span>, <span class="st">"ROX"</span>),
  stringsAsFactors = <span class="fl">FALSE</span>
)

<span class="co">## Create empty RDML object</span>
<span class="kw">sim</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>()
<span class="co">## Add fluorescence data</span>
<span class="kw">sim</span><span class="op">$</span><span class="fu"><a href="../reference/SetFData.html">SetFData</a></span>(<span class="kw">fdata</span>, <span class="kw">descr</span>)

<span class="co">## Observe object</span>
<span class="kw">sim</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">fdata</span> <span class="op">&lt;-</span> <span class="kw">sim</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(<span class="kw">sim</span><span class="op">$</span><span class="fu"><a href="../reference/AsTable.html">AsTable</a></span>(),
                      long.table = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">fdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">cyc</span>, <span class="kw">fluor</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(group = <span class="kw">fdata.name</span>,
                color = <span class="kw">target</span>,
                linetype = <span class="kw">sample</span>))
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-15-2.png" width="576"></p>
</div>
<div id="creating-rdml-from-abi-7500-v-2-software" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-rdml-from-abi-7500-v-2-software" class="anchor"></a>Creating <strong>RDML</strong> from <em>ABI 7500 v.2</em> software</h3>
<p><strong>RDML</strong> objects can be created from <em>.eds</em> files generated by the <em>ABI 7500 v.2</em> or <em>StepOne</em> software (here, all analyses have to be conducted within the device software!).</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/from_abi7500/sce.eds"</span>, package = <span class="st">"RDML"</span>)
<span class="kw">abi</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(filename = <span class="kw">filename</span>)
<span class="kw">abi</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
</div>
<div id="creating-rdml-from--csv-files" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-rdml-from--csv-files" class="anchor"></a>Creating <strong>RDML</strong> from <em>.csv</em> files</h3>
<p><strong>RDML</strong> objects can be generated from <em>.csv</em> files. The files need to contain a first column named <strong>cyc</strong> for qPCR data or <strong>tmp</strong> for melting data. The remaining columns must contain the raw fluorescence signals.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/from_tables/fdata.csv"</span>, package = <span class="st">"RDML"</span>)
<span class="kw">csv</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(filename = <span class="kw">filename</span>)
<span class="kw">csv</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
</div>
<div id="creating-rdml-from--xls-or--xslx-files" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-rdml-from--xls-or--xslx-files" class="anchor"></a>Creating <strong>RDML</strong> from <em>.xls</em> or <em>.xslx</em> files</h3>
<p><strong>RDML</strong> objects can also be generated from <em>.xls</em> or <em>.xslx</em> files. The files need to contain a <em>description</em> data.frame at tab sheet <em>description</em> and qPCR data at tab sheet <em>adp</em>, and/or qPCR data at tab sheet <em>mdp</em>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/from_tables/table.xlsx"</span>, package = <span class="st">"RDML"</span>)
<span class="kw">xslx</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(filename = <span class="kw">filename</span>)
<span class="co">#&gt; Warning in base::as.numeric(gsub(",", ".", val)): NAs introduced by coercion</span>

<span class="co">#&gt; Warning in base::as.numeric(gsub(",", ".", val)): NAs introduced by coercion</span>
<span class="kw">xslx</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>Also <em>.xlsx</em> import can be used with <em>BioRad</em> <em>Custom Export - xlsx</em>. Only main sheet have to be renamed as <em>description</em> and <em>adp</em>/<em>mdp</em> sheets added (from <em>Quantification Data</em> tab, then select <em>RFU</em> at dropdown list). See <em>extdata/from_tables/BioRad.xlsx</em> for example.</p>
</div>
<div id="functional-style" class="section level3">
<h3 class="hasAnchor">
<a href="#functional-style" class="anchor"></a>Functional style</h3>
<p>To provide a functional programming style that is more convenient in <strong>R</strong>, the <strong>RDML</strong> class methods have function wrappers:</p>
<ul>
<li>
<code>obj$AsTable(...)</code> – <code><a href="../reference/AsTable.html">AsTable(obj, ...)</a></code>
</li>
<li>
<code>obj$SetFData(...)</code> – <code><a href="../reference/SetFData.html">SetFData(obj, ...)</a></code>
</li>
<li>
<code>obj$GetFData(...)</code> – <code><a href="../reference/GetFData.html">GetFData(obj, ...)</a></code>
</li>
<li>
<code>obj$AsDendrogram(...)</code> – <code><a href="../reference/AsDendrogram.html">AsDendrogram(obj, ...)</a></code>
</li>
</ul>
</div>
<div id="using" class="section level3">
<h3 class="hasAnchor">
<a href="#using" class="anchor"></a>Using</h3>
</div>
<div id="summary" class="section level3">
<h3 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h3>
<p>The <strong>RDML</strong> package provides classes and methods to work with RDML data generated by real-time quantitative PCR devices or enables creating RDML files from user generated data. Because classes of the <strong>RDML</strong> package are built with <strong>R6</strong>, they can be modified by adding custom methods and ensure type safe usage through input validation.</p>
</div>
</div>
<div id="creating-rdml-file-from-raw-data" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-rdml-file-from-raw-data" class="anchor"></a>Creating RDML file from raw data</h1>
<p>This vignette describes important step how to create <strong>RDML</strong> object from user provided data and calculate Cq values with custom <strong>RDML</strong> class method. We use a real-world example to demonstrate the use of the <strong>RDML</strong> package.</p>
<p>For this purpose we used data from the <em>VideoScan</em> platform. The <em>VideoScan</em> platform is a highly versatile fluorescence microscope based imaging platform for the real-time analysis of biomolecular interactions. <em>VideoScan</em> has been extended by a heating/cooling-unit, which can be used for DNA melting curve analysis <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger_RJ_2013"><strong>???</strong></span>)</span>, real-time quantitative PCR <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger_highly_2013"><strong>???</strong></span>)</span> and quantitative isothermal amplification <span class="citation">(<span class="citeproc-not-found" data-reference-id="spiess_impact_2014"><strong>???</strong></span>)</span>. In this example we focus on qPCR data obtained from the amplification of the human gene <em>mlc-2v</em> <span class="citation">(<span class="citeproc-not-found" data-reference-id="sheikh_2015"><strong>???</strong></span>)</span>. The experimental details (e.g., primer sequences, amplification conditions) are described in <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger_highly_2013"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="george_development_2016"><strong>???</strong></span>)</span>.</p>
<p>In detail, this dataset contains three amplification curves collected by three runs monitored with TaqMan qPCR chemistry. Similar to other experimental platforms has the <em>VideoScan</em> systems an output as <em>csv</em> file (comma separated value). In general, <em>csv</em> is a format that is sufficient for an in house usage. However, the exchange with other scientists is demanding, since experimental metadata is not consistently included in csv files. These are for example information about qPCR conditions, primers, experimentalist and so on as described in the MIQE and RDML standard documentations.</p>
<p>All <em>csv</em> raw data were transferred to the <strong>R</strong> environment and stored as <em>rda</em> files in the <strong>C54</strong> dataset after completion of the experiment as described elsewhere <span class="citation">(<span class="citeproc-not-found" data-reference-id="RDCT2010c"><strong>???</strong></span>)</span>. The <strong>R</strong> environment provides numerous packages for the import of standard file formats, including formats from spread sheet applications (e.g., <em>XLS</em>, <em>XLSX</em>, <em>ODS</em>) <span class="citation">(<span class="citeproc-not-found" data-reference-id="Schutten_2014_ods"><strong>???</strong></span>)</span>, an ODBC connection <span class="citation">(<span class="citeproc-not-found" data-reference-id="ripley_rodbc_2015"><strong>???</strong></span>)</span> or from the clipboard (<code><a href="https://rdrr.io/r/utils/read.table.html">read.table("clipboard")</a></code>). There are several graphical user interfaces (GUIs) for <strong>R</strong>, which facilitate an easy import of raw data <span class="citation">(<span class="citeproc-not-found" data-reference-id="Valero_2012"><strong>???</strong></span>)</span>. For example <strong>RKWard</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger_rkward_2012"><strong>???</strong></span>)</span> has import functionality for <em>csv</em>, <em>txt</em>, <em>spss</em> and <em>stata</em> files.</p>
<p>We will use the <strong>C54</strong> dataset directly from the <a href="https://CRAN.R-project.org/package=chipPCR">chipPCR</a> package <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger2015chippcr"><strong>???</strong></span>)</span>. The amplification curves have different number of cycles and one of them contains a missing value due to a sensor dropout. Thus, this data should be preprocessed before Cq calculation.</p>
<p><strong>R</strong> is a language with dynamic typing. This is helpful while scripting, but can lead to problematic debugging of more complicated workflows. <strong><em>R6</em></strong> classes provide type-safe interfaces to set data without access to the inner structure of objects so that all imported data can be validated. This option is highly useful when creating packages at an intermediate level for other packages (e.g., such an approach does not permit set type <strong><em>character</em></strong> in place of type <strong><em>integer</em></strong>). Furthermore, the inheritance of <strong><em>R6</em></strong> objects unifies the structure of the package and streamlines the extending of its capabilities (since the whole package is written around a single base class).</p>
<div id="initialization" class="section level2">
<h2 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h2>
<p>First of all we have to load all necessary packages and fluorescence data into our <strong>R</strong> session.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/PCRuniversum/RDML">RDML</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/michbur/chipPCR">chipPCR</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/michbur/MBmca">MBmca</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">C54</span>)
</pre></div>
<p>We can see that our data are arranged in data.frame with cycle numbers in the first column and fluorescence values in the other columns. Such data structure is ready to use with the <strong>RDML</strong> package and does not need any conversion.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">C54</span>)
<span class="co">#&gt; 'data.frame':    56 obs. of  4 variables:</span>
<span class="co">#&gt;  $ Cycle: num  0 1 2 3 4 5 6 7 8 9 ...</span>
<span class="co">#&gt;  $ D1   : num  0.141 0.146 0.152 0.151 0.153 ...</span>
<span class="co">#&gt;  $ D2   : num  0.148 0.148 0.148 0.149 0.149 ...</span>
<span class="co">#&gt;  $ D3   : num  0.145 0.147 0.148 0.148 0.149 ...</span>
</pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit">

<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(Cycle = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">C54</span>[, <span class="fl">1</span>], <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="kw">C54</span>) <span class="op">-</span> <span class="fl">1</span>),
                  Experiment = <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">C54</span>)[<span class="op">-</span><span class="fl">1</span>], <span class="fu">function</span>(<span class="kw">i</span>) <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">C54</span>)))),
                  refMFi = <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw">C54</span>[, <span class="op">-</span><span class="fl">1</span>]))
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="kw">dat</span>[[<span class="st">"Experiment"</span>]]) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"D1 - Stock cDNA"</span>, <span class="st">"D2 - 1/10 cDNA"</span>, <span class="st">"D3 - 1/100 cDNA"</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">Cycle</span>, y = <span class="kw">refMFi</span>, colour = <span class="kw">Experiment</span>)) <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
</div>
<div id="creating-custom-method-for-rdml-class" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-custom-method-for-rdml-class" class="anchor"></a>Creating custom method for <strong>RDML</strong> class</h2>
<p>The preprocessing and Cq calculation steps are held within a <strong>RDML</strong> object. To do this we shall add custom method to the <strong>RDML</strong> class and use this advanced class as <strong>RDML</strong> object initializator (data import).</p>
<p>As described previously <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger2015r"><strong>???</strong></span>)</span>, we first preprocess the raw data with the <strong>CPP</strong> function from the <a href="https://CRAN.R-project.org/package=chipPCR">chipPCR</a> package. Next, these preprocessed data are stored in new runs within the same experiment. For Cq calculation we used the <strong>diffQ2</strong> function from the <a href="https://CRAN.R-project.org/package=MBmca">MBmca</a> <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger_RJ_2013"><strong>???</strong></span>)</span> package. Note, there are other functions available within <strong>R</strong> to determine the Cq values. The <a href="https://CRAN.R-project.org/package=qpcR">qpcR</a> package is one of the most popular packages for such tasks.</p>
<p>Additional our method will have two arguments:</p>
<ul>
<li>vector <code>last.cycle</code> – cycle limits for every amplification curve;</li>
<li>list <code>bg.range</code> – background range for every amplification curve.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="kw">RDML</span><span class="op">$</span><span class="fu">set</span>(<span class="st">"public"</span>, <span class="st">"ProcessVideoScan"</span>,
         <span class="fu">function</span>(<span class="kw">last.cycle</span>,
                  <span class="kw">bg.range</span>) {
           <span class="co"># Get curves description</span>
           <span class="kw">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">self</span><span class="op">$</span><span class="fu"><a href="../reference/AsTable.html">AsTable</a></span>())
           <span class="co"># Get fluorescent point</span>
           <span class="fu"><a href="https://rdrr.io/r/base/warning.html">warning</a></span>(<span class="kw">tab</span>)
           <span class="kw">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">self</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(<span class="kw">tab</span>))
           <span class="co"># Give new names to runs</span>
           <span class="co"># Preprocess amplification curve raw data as described in </span>
           <span class="co"># R&amp;ouml;diger et al. (2015) Bioinformatics. Note that the dataset</span>
           <span class="co"># has different length of cycle numbers and missing values (NAs).</span>
           <span class="co"># The CPP function from the chipPCR package prepares the data for </span>
           <span class="co"># further analysis.</span>
           <span class="kw">tab</span>[, <span class="st">"run.id"</span>] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">tab</span>[, <span class="st">"run.id"</span>], <span class="st">"_CPP"</span>)
           
           <span class="co"># Curves will be used one by one</span>
           <span class="co">for</span> (<span class="kw">i</span> <span class="co">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">dat</span>)) {
             <span class="co"># Preprocess data</span>
             <span class="kw">preprocessed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chipPCR/man/CPP.html">CPP</a></span>(<span class="kw">dat</span>[<span class="fl">1</span><span class="op">:</span><span class="kw">last.cycle</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>], <span class="fl">1</span>], 
                                 <span class="kw">dat</span>[<span class="fl">1</span><span class="op">:</span><span class="kw">last.cycle</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>], <span class="kw">i</span>],
                                 trans = <span class="fl">TRUE</span>,
                                 bg.range = <span class="kw">bg.range</span>[[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>]])[[<span class="st">"y.norm"</span>]]
             <span class="co"># Create data.frame with cycle number and preprocessed curve Then</span>
             <span class="co"># give name to fluorescence points columns as before preprocessing</span>
             <span class="kw">dat_CPP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">dat</span>[<span class="fl">1</span><span class="op">:</span><span class="kw">last.cycle</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>], <span class="fl">1</span>],
                              <span class="kw">preprocessed</span>)
             <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">dat_CPP</span>)[<span class="fl">2</span>] <span class="op">&lt;-</span> <span class="kw">tab</span><span class="op">$</span><span class="kw">fdata.name</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>]
             <span class="co"># Set preprocessed data with new description (new run names)</span>
             <span class="kw">self</span><span class="op">$</span><span class="fu"><a href="../reference/SetFData.html">SetFData</a></span>(<span class="kw">dat_CPP</span>, <span class="kw">tab</span>)
             <span class="co"># Calculate and set Cq</span>
             <span class="co"># Set Cq from second derivative maximum method as described in </span>
             <span class="co"># R&amp;ouml;diger et al. (2015) Bioinformatics for preprocessed data.</span>
             <span class="co"># The diffQ2 function from the MBmca package </span>
             <span class="co"># (R&amp;ouml;diger et al. (2013), The R Journal) was used to calculate the</span>
             <span class="co"># Cq values of each amplification curve.</span>
             <span class="kw">cq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MBmca/man/diffQ2.html">diffQ2</a></span>(<span class="kw">dat_CPP</span>, inder = <span class="fl">TRUE</span>)[[<span class="st">"xTm1.2.D2"</span>]][<span class="fl">1</span>]
             <span class="kw">self</span><span class="op">$</span><span class="kw">experiment</span>[[<span class="kw">tab</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"exp.id"</span>]]]<span class="op">$</span>
               <span class="kw">run</span>[[<span class="kw">tab</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"run.id"</span>]]]<span class="op">$</span>
               <span class="kw">react</span>[[<span class="kw">tab</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"react.id"</span>]]]<span class="op">$</span>
               <span class="kw">data</span>[[<span class="kw">tab</span>[<span class="kw">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"target"</span>]]]<span class="op">$</span><span class="kw">cq</span> <span class="op">&lt;-</span> <span class="kw">cq</span>
           }
         }, overwrite = <span class="fl">TRUE</span>
)
</pre></div>
</div>
<div id="rdml-object-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#rdml-object-creation" class="anchor"></a><strong>RDML</strong> object creation</h2>
<p>Now we can create an empty <strong>RDML</strong> object with our advanced class and set the fluorescence data into it. For setting the data we have to create a description (metadata) of the amplification curves, which contain:</p>
<ul>
<li>
<code>fdata.name</code> – curve name. Have to be as columns names in data.frame with fluorescence data.</li>
<li>
<code>exp.id</code> – experiment name.</li>
<li>
<code>run.id</code> – run name. In our case we have three runs.</li>
<li>
<code>react.id</code> – react ID. E.g., number of tube within a reaction plate.</li>
<li>
<code>sample</code> – sample name.</li>
<li>
<code>type</code> – sample type.</li>
<li>
<code>target</code> – target name. E.g., gene of interest name.</li>
<li>
<code>target.dyeID</code> – fluorescent dye used for detection.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="co"># Create a data frame of metadata </span>
<span class="kw">description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  fdata.name = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"D1"</span>, <span class="st">"D2"</span>, <span class="st">"D3"</span>),
  exp.id = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"exp1"</span>, <span class="st">"exp1"</span>, <span class="st">"exp1"</span>),
  run.id = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"run1"</span>, <span class="st">"run2"</span>, <span class="st">"run3"</span>),
  react.id = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>),
  sample = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"D1 - Stock cDNA"</span>, <span class="st">"D2 - 1/10 cDNA"</span>, <span class="st">"D3 - 1/100 cDNA"</span>),
  sample.type = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"unkn"</span>, <span class="st">"unkn"</span>, <span class="st">"unkn"</span>),
  target = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"MLC-2v"</span>, <span class="st">"MLC-2v"</span>, <span class="st">"MLC-2v"</span>),
  target.dyeId = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Cy5"</span>, <span class="st">"Cy5"</span>, <span class="st">"Cy5"</span>),
  stringsAsFactors = <span class="fl">FALSE</span>
)

<span class="co"># Create an empty RDML object</span>
<span class="kw">video.scan</span> <span class="op">&lt;-</span> <span class="kw">RDML</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>()

<span class="co"># Add fluorescence data and metadata to the RDML object from a given source.</span>
<span class="co"># For the sake of simplicity we use the C54 dataset from the chipPCR package.</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="fu"><a href="../reference/SetFData.html">SetFData</a></span>(<span class="kw">C54</span>, <span class="kw">description</span>)
</pre></div>
</div>
<div id="setting-additional-information" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-additional-information" class="anchor"></a>Setting additional information</h2>
<p>As optional step, we can add some information about our experiment. Such as experimenter contacts, references to documentation, description of samples and targets, thermal cycling conditions, etc.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="co"># Add experimentalist information</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">experimenter</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">experimenterType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
      <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"SR"</span>),
      <span class="st">"Stefan"</span>,
      <span class="st">"Roediger"</span>,
      <span class="st">"stefan.roediger@b-tu.de"</span>
    ),
    <span class="kw">experimenterType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
      <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"CD"</span>),
      <span class="st">"Claudia"</span>,
      <span class="st">"Deutschmann"</span>
    )
  )

<span class="co"># Add a reference to documentation</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">documentation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">documentationType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
    <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"Roediger et al. 2013"</span>),
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"A Highly Versatile Microscope Imaging Technology Platform for the Multiplex"</span>,
          <span class="st">"Real-Time Detection of Biomolecules and Autoimmune Antibodies. S. Roediger,"</span>,
          <span class="st">"P. Schierack, A. Boehm, J. Nitschke, I. Berger, U. Froemmel, C. Schmidt, M."</span>,
          <span class="st">"Ruhland, I. Schimke, D. Roggenbuck, W. Lehmann and C. Schroeder. Advances in"</span>,
          <span class="st">"Biochemical Bioengineering/Biotechnology. 133:33-74, 2013."</span>,
          <span class="st">"https://www.ncbi.nlm.nih.gov/pubmed/22437246"</span>)
  )
)

<span class="kw">cdna</span> <span class="op">&lt;-</span> 
  <span class="kw">cdnaSynthesisMethodType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
    enzyme = <span class="st">"SuperScript II"</span>,
    primingMethod =
      <span class="kw">primingMethodType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"oligo-dt"</span>),
    dnaseTreatment = <span class="fl">TRUE</span>
  )
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">`D1 - Stock cDNA`</span><span class="op">$</span><span class="kw">description</span> <span class="op">&lt;-</span> <span class="st">"Input stock cDNA was used undiluted (D1)"</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">`D1 - Stock cDNA`</span><span class="op">$</span><span class="kw">cdnaSynthesisMethod</span> <span class="op">&lt;-</span> <span class="kw">cdna</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">`D2 - 1/10 cDNA`</span><span class="op">$</span><span class="kw">description</span> <span class="op">&lt;-</span> <span class="st">"1/1000 diluted in A. bidest"</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">`D2 - 1/10 cDNA`</span><span class="op">$</span><span class="kw">cdnaSynthesisMethod</span> <span class="op">&lt;-</span> <span class="kw">cdna</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">`D3 - 1/100 cDNA`</span><span class="op">$</span><span class="kw">description</span> <span class="op">&lt;-</span> <span class="st">"1/1000000 diluted in A. bidest"</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">sample</span><span class="op">$</span><span class="kw">`D3 - 1/100 cDNA`</span><span class="op">$</span><span class="kw">cdnaSynthesisMethod</span> <span class="op">&lt;-</span> <span class="kw">cdna</span>

<span class="kw">video.scan</span><span class="op">$</span><span class="kw">target</span><span class="op">$</span><span class="kw">`MLC-2v`</span><span class="op">$</span><span class="kw">xRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">xRefType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"uniprot"</span>,
               <span class="st">"P10916"</span>)
)
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">target</span><span class="op">$</span><span class="kw">`MLC-2v`</span><span class="op">$</span><span class="kw">sequences</span> <span class="op">&lt;-</span> 
  <span class="kw">sequencesType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
    <span class="kw">forwardPrimer</span> <span class="op">&lt;-</span> <span class="kw">oligoType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
      sequence = <span class="st">"ACAGGGATGGCTTCATTGAC"</span>),
    <span class="kw">reversePrimer</span> <span class="op">&lt;-</span> <span class="kw">oligoType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
      sequence = <span class="st">"ATGCGTTGAGAATGGTTTCC"</span>),
    <span class="kw">probe1</span> <span class="op">&lt;-</span> <span class="kw">oligoType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
      threePrimeTag = <span class="st">"Atto647N"</span>,
      sequence = <span class="st">"CAGGGTCCGCTCCCTTAAGTTTCTCC"</span>,
      fivePrimeTag = <span class="st">"BHQ2"</span>)
  )

<span class="kw">tcc</span> <span class="op">&lt;-</span> 
  <span class="kw">thermalCyclingConditionsType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
    <span class="kw">idType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"Amplification"</span>),
    experimenter = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="kw">idReferencesType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"SR"</span>),
      <span class="kw">idReferencesType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"CD"</span>)
    ),
    step = 
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">stepType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
          nr = <span class="fl">1</span>,
          temperature = <span class="kw">temperatureType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="fl">95</span>,
                                            <span class="fl">600</span>)
        ),
        <span class="kw">stepType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
          nr = <span class="fl">2</span>,
          temperature = <span class="kw">temperatureType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="fl">95</span>,
                                            <span class="fl">40</span>)
        ),
        <span class="kw">stepType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
          nr = <span class="fl">3</span>,
          temperature = <span class="kw">temperatureType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="fl">58.5</span>,
                                            <span class="fl">90</span>)
        ),
        <span class="kw">stepType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
          nr = <span class="fl">4</span>,
          temperature = <span class="kw">temperatureType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="fl">68.5</span>,
                                            <span class="fl">90</span>)
        ),
        <span class="kw">stepType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(
          nr = <span class="fl">5</span>,
          loop = <span class="kw">loopType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(goto = <span class="fl">2</span>,
                              repeat.n = <span class="fl">49</span>)
        )
      )
  )
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">thermalCyclingConditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">tcc</span>
)

<span class="co">#add description of the experiment</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">experiment</span><span class="op">$</span><span class="kw">exp1</span><span class="op">$</span><span class="kw">description</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"The aim was to amplify MLC-2v in the VideoScan and to monitor with a"</span>,
        <span class="st">"hydrolysis probe for MLC-2v. The primer sequences for MLC-2v were taken"</span>,
        <span class="st">"from Roediger et al. (2013). The amplification was detected in solution of"</span>,
        <span class="st">"the 1 HCU (see Roediger et al. 2013 for details). A 20 micro L PCR reaction"</span>,
        <span class="st">"was composed of 250 nM primer (forward and reverse), 1x Maxima Probe qPCR"</span>,
        <span class="st">"Master Mix (Fermentas), 1 micro L template (MLC-2v amplification product in"</span>,
        <span class="st">"different dilutions), 50 nM hydrolysis probe for MLC-2v and A."</span>,
        <span class="st">"bidest. During the amplification, fluorescence was measured at 59.5 degree"</span>,
        <span class="st">"Celsius. The Cy5 channel was used to monitor the MLC-2v specific hydrolysis"</span>,
        <span class="st">"probe. Input stock cDNA was used undiluted (D1). D2 was 1/1000 and D3"</span>,
        <span class="st">"1/1000000 diluted in A. bidest. The D1, D2, and D3 have different numbers"</span>,
        <span class="st">"measure points and D2 contains a missing value at cycle 37."</span>)
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">experiment</span><span class="op">$</span><span class="kw">exp1</span><span class="op">$</span><span class="kw">run</span><span class="op">$</span><span class="kw">run1</span><span class="op">$</span><span class="kw">thermalCyclingConditions</span> <span class="op">&lt;-</span> <span class="kw">idReferencesType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"Amplification"</span>)
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">experiment</span><span class="op">$</span><span class="kw">exp1</span><span class="op">$</span><span class="kw">run</span><span class="op">$</span><span class="kw">run2</span><span class="op">$</span><span class="kw">thermalCyclingConditions</span> <span class="op">&lt;-</span> <span class="kw">idReferencesType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"Amplification"</span>)
<span class="kw">video.scan</span><span class="op">$</span><span class="kw">experiment</span><span class="op">$</span><span class="kw">exp1</span><span class="op">$</span><span class="kw">run</span><span class="op">$</span><span class="kw">run3</span><span class="op">$</span><span class="kw">thermalCyclingConditions</span> <span class="op">&lt;-</span> <span class="kw">idReferencesType</span><span class="op">$</span><span class="fu"><a href="../reference/new.html">new</a></span>(<span class="st">"Amplification"</span>)
</pre></div>
</div>
<div id="processing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#processing-data" class="anchor"></a>Processing data</h2>
<p>After creating <strong>RDML</strong> object and setting data we can use our method <code>$ProcessVideoScan</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="co"># Process VideoScan data</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="fu">ProcessVideoScan</span>(last.cycle = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">55</span>),
                            bg.range = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">8</span>),
                                            <span class="kw">NULL</span>,
                                            <span class="kw">NULL</span>))
<span class="co">#&gt; Warning in video.scan$ProcessVideoScan(last.cycle = c(35, 45, 55),</span>
<span class="co">#&gt; bg.range = list(c(1, : c("A01_D1 - Stock cDNA_unkn_MLC-2v", "A01_D2 - 1/10</span>
<span class="co">#&gt; cDNA_unkn_MLC-2v", "A01_D3 - 1/100 cDNA_unkn_MLC-2v")c("exp1", "exp1",</span>
<span class="co">#&gt; "exp1")c("run1", "run2", "run3")c(1, 1, 1)c("A01", "A01", "A01")c("D1 -</span>
<span class="co">#&gt; Stock cDNA", "D2 - 1/10 cDNA", "D3 - 1/100 cDNA")c("MLC-2v", "MLC-2v",</span>
<span class="co">#&gt; "MLC-2v")c("Cy5", "Cy5", "Cy5")c("unkn", "unkn", "unkn")c(TRUE, TRUE,</span>
<span class="co">#&gt; TRUE)c(FALSE, FALSE, FALSE)</span>
</pre></div>
<p>Then visualize the object with the <code>$AsDendrogram</code> method (runs with IDs that include <code>_CPP</code> in names, contain the preprocessed curves):</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="co"># Visualize RDML object</span>
<span class="kw">video.scan</span><span class="op">$</span><span class="fu"><a href="../reference/AsDendrogram.html">AsDendrogram</a></span>()
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-29-1.png" width="576"></p>
<p>And plot preprocessed curves indicating the Cq values:</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="co">## Visualise preprocessed data with Cq values as vertical dashed lines</span>
<span class="co"># Add custom column that contains the calculated Cq</span>
<span class="kw">tab</span> <span class="op">&lt;-</span> <span class="kw">video.scan</span><span class="op">$</span><span class="fu"><a href="../reference/AsTable.html">AsTable</a></span>(
  cq = {
    <span class="kw">cq</span> <span class="op">&lt;-</span> <span class="kw">data</span><span class="op">$</span><span class="kw">cq</span>
    <span class="co">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="kw">cq</span>) <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">cq</span>))
      <span class="kw">NULL</span>
    <span class="co">else</span>
      <span class="kw">cq</span>
  })
<span class="co"># Get preprocessed data in 'long.table' format</span>
<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="kw">video.scan</span><span class="op">$</span><span class="fu"><a href="../reference/GetFData.html">GetFData</a></span>(<span class="kw">tab</span>[<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"_CPP"</span>, <span class="kw">tab</span>[[<span class="st">"run.id"</span>]]), ],
                           long.table = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">cyc</span>, y = <span class="kw">fluor</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(group = <span class="kw">fdata.name</span>, color = <span class="kw">fdata.name</span>),
            size = <span class="fl">1.2</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(xintercept = <span class="kw">cq</span>, color = <span class="kw">fdata.name</span>),
             linetype = <span class="st">"longdash"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="st">"Cycle"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="st">"Fluorescence"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Amplification of human MLC-2v\nVideoScan HCU"</span>)
</pre></div>
<p><img src="RDML_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
<p>However, there are further <strong>R</strong> packages on <a href="https://cran.r-project.org/">CRAN</a>, <a href="http://bioconductor.org/">Bioconductor</a> and <a href="https://github.com/">GitHub</a>, which can be used with the RDML package <span class="citation">(<span class="citeproc-not-found" data-reference-id="roediger2015r"><strong>???</strong></span>)</span> to deal with non-detects <span class="citation">(<span class="citeproc-not-found" data-reference-id="mccall_non-detects_2014"><strong>???</strong></span>)</span>, normalization <span class="citation">(<span class="citeproc-not-found" data-reference-id="perkins_readqpcr_2012"><strong>???</strong></span>)</span>, expression analysis <span class="citation">(<span class="citeproc-not-found" data-reference-id="dvinge_htqpcr:_2009"><strong>???</strong></span>, matz_no_2013)</span> and periodicity in qPCR systems <span class="citation">(<span class="citeproc-not-found" data-reference-id="spiess_system-specific_2016"><strong>???</strong></span>)</span>.</p>
</div>
<div id="export-to-file" class="section level2">
<h2 class="hasAnchor">
<a href="#export-to-file" class="anchor"></a>Export to file</h2>
<p>To save our <strong>RDML</strong> object as file we can use <code>$AsXML()</code> method with file name as argument:</p>
<p><code>video.scan$AsXML("filename.RDML")</code></p>
<p><em>Note that currently due to limits of <code>XML</code> package it is rather slow operation!!!</em></p>
<p>A XML files can be compressed to save space. The <strong>RMDL</strong> package uses the <code><a href="https://rdrr.io/r/utils/zip.html">zip()</a></code> function from the <strong>utils</strong> package with default values to compress the RDML file. Therefore, the compression mode depends on the operating system. The <strong>RDML</strong> function <code>AsXML()</code> without an argument returns one string, which contains the XML data. This can be used to compress it with any other compression algorithm.</p>
</div>
<div id="benchmark-of-the-rdml-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark-of-the-rdml-generation" class="anchor"></a>Benchmark of the RDML generation</h2>
<p>The XML format becomes less efficient to work with at larger file sizes and complex structured information (e.g., matrices). Therefore, a limitation of RMDL is the process of the file generation. This characteristic is inherited by the <strong>RDML</strong> package. Speed is an issue in high-throughput applications. To give the user a foundation for a decision support if the implementation of the RMDL format is advisable, we performed a benchmark. We used the <strong>microbenchmark</strong> package <span class="citation">(<span class="citeproc-not-found" data-reference-id="Mersmann_2014_microbenchmark"><strong>???</strong></span>)</span> to assess the time required for generation of RDML files. The simulation included datasets with ranging from 1 to 1000 entries per file.</p>
</div>
<div id="dealing-with-other-data-formats" class="section level2">
<h2 class="hasAnchor">
<a href="#dealing-with-other-data-formats" class="anchor"></a>Dealing with other data formats</h2>
<p>Researchers often collect gene expression data from more than one laboratory and and are thus required to analyze and aggregate many data sets. Adaptable data management - also known as “adaptive informatics” - is relevant in cases where data from different omics approaches and assays (e.g., flow cytometry, digital PCR, NGS) need to be merged <span class="citation">(<span class="citeproc-not-found" data-reference-id="baker_quantitative_2012"><strong>???</strong></span>)</span>. As RDML is based on XML, it is possible to converge the files with other formats such as HDF, <span class="citation">(<span class="citeproc-not-found" data-reference-id="millard_adaptive_2011"><strong>???</strong></span>)</span> which is supported by <strong>R</strong> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Fischer_HDF5"><strong>???</strong></span>)</span>. This enables extended data storage and analysis, but also a higher level of experimental data management.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>In this example we used raw data from the <em>VideoScan</em> platform to demonstrate the creation of an <em>RDML</em> file via the <strong>RDML</strong> package. This procedure can be easily adapted to other experiments and devices and gives the researcher a tool to create a file in a standardized format for convenient data exchange. In contrast to simple <em>csv</em> files contains this file additional metadata in a defined structure. This in turn makes the data available to other scientists for reproducible research.</p>
</div>
<div id="benchmark" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark" class="anchor"></a>Benchmark</h2>
<p>The RDML format may also store data from high-throughput technologies such as digital PCR or 384-well qPCR. To make the RDML package the most appropriate tool for these applications, we optimized the saving functionality of the package. Hence, the RDML package is able to save even large numbers of qPCR experiments in reasonable time.</p>
<p>We benchmarked the time needed for saving RDML object with different numbers of experiments on two desktop machines:</p>
<ol style="list-style-type: decimal">
<li><p>Windows 7 x64 (build 7601) Service Pack 1 on Intel Core i5 (2,40 GHz) with 4,00 GB RAM. R version 3.2.1 (2015-06-18).</p></li>
<li><p>Kubuntu 15.04 (Kernel 3.19.0-27-generic) Intel(R) Pentium(R) CPU 997 @ 1.60GHz with 4,00 GB RAM. R version 3.1.2 (2014-10-31).</p></li>
</ol>
<p>To warrant fairest comparison and taking into account factors like garbage collection, we repeated the procedure 100 times.</p>
<p><img src="RDML_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<table class="table">
<caption>Results of benchmark.</caption>
<thead><tr class="header">
<th align="right">Number of experiments</th>
<th align="right">Median time [s]</th>
<th align="left">Operating System</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0525600</td>
<td align="left">Windows</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.1965201</td>
<td align="left">Windows</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">0.4882732</td>
<td align="left">Windows</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">0.7770339</td>
<td align="left">Windows</td>
</tr>
<tr class="odd">
<td align="right">32</td>
<td align="right">0.8454795</td>
<td align="left">Windows</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">1.4801968</td>
<td align="left">Windows</td>
</tr>
<tr class="odd">
<td align="right">96</td>
<td align="right">3.8208417</td>
<td align="left">Windows</td>
</tr>
<tr class="even">
<td align="right">100</td>
<td align="right">4.0498602</td>
<td align="left">Windows</td>
</tr>
<tr class="odd">
<td align="right">300</td>
<td align="right">25.6566066</td>
<td align="left">Windows</td>
</tr>
<tr class="even">
<td align="right">384</td>
<td align="right">39.9697519</td>
<td align="left">Windows</td>
</tr>
<tr class="odd">
<td align="right">765</td>
<td align="right">142.1440033</td>
<td align="left">Windows</td>
</tr>
<tr class="even">
<td align="right">1000</td>
<td align="right">239.7105810</td>
<td align="left">Windows</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0665418</td>
<td align="left">Unix</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.2468777</td>
<td align="left">Unix</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">0.6101219</td>
<td align="left">Unix</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">0.9658560</td>
<td align="left">Unix</td>
</tr>
<tr class="odd">
<td align="right">32</td>
<td align="right">1.0468907</td>
<td align="left">Unix</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">1.8240828</td>
<td align="left">Unix</td>
</tr>
<tr class="odd">
<td align="right">96</td>
<td align="right">4.5716005</td>
<td align="left">Unix</td>
</tr>
<tr class="even">
<td align="right">100</td>
<td align="right">4.8454858</td>
<td align="left">Unix</td>
</tr>
<tr class="odd">
<td align="right">300</td>
<td align="right">29.0860889</td>
<td align="left">Unix</td>
</tr>
<tr class="even">
<td align="right">384</td>
<td align="right">44.9543657</td>
<td align="left">Unix</td>
</tr>
<tr class="odd">
<td align="right">765</td>
<td align="right">159.6792129</td>
<td align="left">Unix</td>
</tr>
<tr class="even">
<td align="right">1000</td>
<td align="right">266.5159046</td>
<td align="left">Unix</td>
</tr>
</tbody>
</table>
<p>The results above indicate that, thanks to the RDML package, an average laboratory workstation is able to save large RDML files in reasonable time (around 4 minutes for 1000 experiments).</p>
</div>
<div id="validation-of-rdml-files-created-by-the-rdml-package" class="section level2">
<h2 class="hasAnchor">
<a href="#validation-of-rdml-files-created-by-the-rdml-package" class="anchor"></a>Validation of RDML files created by the RDML package</h2>
<p>The correct structure of an RDML file is an important prerequisite to perform reproducible analysis. Unfortunately, the created files can not be properly tested to date because the official RDML validator <a href="http://rdml.org/tools.php">rdml.org</a> is not online from time to time. However, there is a solution to validate the files by the alternate editor - <em>RDML-Ninja</em> <span class="citation">(<span class="citeproc-not-found" data-reference-id="rdml-ninja_2015"><strong>???</strong></span>)</span>.</p>
</div>
<div id="rdmledit-web-server" class="section level2">
<h2 class="hasAnchor">
<a href="#rdmledit-web-server" class="anchor"></a>RDMLedit web-server</h2>
<p>The <a href="RDMLedit%20web-server">http://shtest.evrogen.net/rdmlEdit/</a> is a web tool based on the functionalities of the RDML package. Aside from basic functionalities like data import, modification and export, RDMLedit also produces visualisations of qPCR data. In addition, RDMLedit can also merge multiple RDML files.</p>
<div id="local-deployment-of-rdmledit" class="section level3">
<h3 class="hasAnchor">
<a href="#local-deployment-of-rdmledit" class="anchor"></a>Local deployment of RDMLedit</h3>
<p>As a <a href="shiny%20application">https://shiny.rstudio.com/</a>, RDMLedit may be also deployed locally. It requires an installed R and RDML package. To initialize, the user has to open R and run the following command: <strong>rdmlEdit()</strong>.</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konstantin A. Blagodatskikh, Stefan Roediger, Michal Burdukiewicz, Andrej-Nikolai Spiess.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
